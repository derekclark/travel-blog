<!doctype html>
<html>
<head>
<script type="text/javascript" src="exif.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="scripts/persistenceWS.js"></script>
<script src="scripts/google-api-parser.js"></script>
<script src="scripts/geocoder.js"></script>
<script src="scripts/googlemap.js"></script>
</head>
<body>
Upload multiple files to read Exif data.
<br/>

<form action="" method="post" enctype="multipart/form-data" name="form1" id="form1">
   <label>upload file<input type="file" multiple name="file" id="file-input" /></label>
   <label><input type="submit" name="button" id="button" value="Submit" /></label>
 </form>

<br/><br/>

<div id="map" style="width: 500px; height: 400px;"></div>

<script>
  function getLat(lat, latRef)
  {
    latRef = latRef || "N";
    return (lat[0] + lat[1]/60 + lat[2]/3600) * (latRef == "N" ? 1 : -1);
  }

  function getLon(lon, lonRef)
  {
    lonRef = lonRef || "W";
    return (lon[0] + lon[1]/60 + lon[2]/3600) * (lonRef == "W" ? -1 : 1);
  }

  function sleep(seconds){
    var waitTill = new Date(new Date().getTime() + seconds * 1000);
    while(waitTill > new Date()){}
  }

  function displayLocationDetails(location){
    for (i=0; i<4; i++){
      console.log('loc='+location[0][i]);
    }
  }

  var lat, lon;
  document.getElementById("file-input").onchange = function(e) {
    var fileList = this.files;
    for (i=0; i<fileList.length;i++){
      console.log("uploading file: " + fileList[i].name);

      console.log(e.target.files[0]);
      EXIF.getData(fileList[i], function() {
        var lat = EXIF.getTag(this, "GPSLatitude");
        var latRef = EXIF.getTag(this, "GPSLatitudeRef");
        var lon = EXIF.getTag(this, "GPSLongitude");
        var lonRef = EXIF.getTag(this, "GPSLongitudeRef");
        var dateTaken = EXIF.getTag(this, "DateTimeOriginal");
        var imagename=this.name;
        console.log(imagename);

        console.log('converted lat='+getLat(lat, latRef));
        console.log('converted lon='+getLon(lon, lonRef));
        console.log(dateTaken);
        lat=getLat(lat, latRef);
        lon=getLon(lon, lonRef);
        var geocoder = new google.maps.Geocoder;
        var locations = [];
        reverseGeocode(geocoder, lat, lon, locations, dateTaken, imagename);
        console.log("loc="+locations.length);
      });
    }
  }

  // function putMarkerOnMap(locations){
  //   var map = new google.maps.Map(document.getElementById('map'), {
  //     zoom: 1,
  //     center: new google.maps.LatLng(50, 0),
  //     mapTypeId: google.maps.MapTypeId.ROADMAP
  //   });
  //
  //   var infowindow = new google.maps.InfoWindow();
  //
  //   var marker, i;
  //
  //   for (i = 0; i < locations.length; i++) {
  //     marker = new google.maps.Marker({
  //       position: new google.maps.LatLng(locations[i][1], locations[i][2]),
  //       map: map
  //     });
  //
  //     google.maps.event.addListener(marker, 'click', (function(marker, i) {
  //       return function() {
  //         infowindow.setContent(locations[i][0]);
  //         infowindow.open(map, marker);
  //       }
  //     })(marker, i));
  //   }
  //
  // }
  //
  // function initMap() {
  //   var map = new google.maps.Map(document.getElementById('map'), {
  //     zoom: 8,
  //     center: {lat: 40.731, lng: -73.997}
  //   });
  //   var geocoder = new google.maps.Geocoder;
  //   var infowindow = new google.maps.InfoWindow;
  // }
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvCwwIejOx2UGOzvd9BgP11m38bb2rXzw&callback=initMap">
</script>


</body>
</html>
